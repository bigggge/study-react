{"version":3,"sources":["lib/light-redux.js","lib/light-redux.test.js","../../light-react/lib/react.js","index-0.js"],"names":["createStore","reducer","initialState","undefined","Error","store","state","listeners","subscribe","listener","push","dispatch","action","forEach","getState","counter","INCREMENT","DECREMENT","type","init","console","log","current","renderComponent","createElement","tag","attrs","children","render","vnode","container","appendChild","_render","String","document","createTextNode","component","createComponent","setComponentProps","element","dom","Object","keys","value","key","setAttribute","child","name","test","toLowerCase","style","cssText","removeAttribute","Component","props","stateChange","assign","inst","prototype","constructor","componentWillMount","componentWillReceiveProps","componentDidUpdate","componentWillUpdate","componentDidMount","parentNode","replaceChild","React","innerHTML","App","num","getElementById"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QCKgBe,UAAAA;;AALhB;;;;;;AAEA,IAAMC,YAAY,WAAlB;AACA,IAAMC,YAAY,WAAlB;;AAEO,SAASF,OAAT,CAAiBT,KAAjB,EAAwBM,MAAxB,EAAgC;AACrC,UAAQA,OAAOM,IAAf;AACE,SAAKF,SAAL;AACE,aAAOV,QAAQ,CAAf;AACF,SAAKW,SAAL;AACE,aAAOX,QAAQ,CAAf;AACF;AACE,aAAO,CAAP;AANJ;AAQD;;AAED,IAAMD,QAAQ,0BAAYU,OAAZ,EAAqB,CAArB,CAAd;AACA,IAAMI,OAAOd,MAAMS,QAAN,EAAb;;AAEAM,QAAQC,GAAR,uBAAgCF,IAAhC;;AAEA,SAASV,QAAT,GAAoB;AAClB,MAAMa,UAAUjB,MAAMS,QAAN,EAAhB;AACAM,UAAQC,GAAR,cAAuBC,OAAvB;AACD;;AAEDjB,MAAMG,SAAN,CAAgBC,QAAhB;AACAJ,MAAMM,QAAN,CAAe,EAAEO,MAAM,WAAR,EAAf;AACAb,MAAMM,QAAN,CAAe,EAAEO,MAAM,WAAR,EAAf;AACAb,MAAMM,QAAN,CAAe,EAAEO,MAAM,WAAR,EAAf;AACAb,MAAMM,QAAN,CAAe,EAAEO,MAAM,WAAR,EAAf;;;;;;;AD9BA;;;;;;AAMA,IAAMlB,cAAc,SAAdA,WAAc,CAACC,OAAD,EAAUC,YAAV,EAA2B;AAC7C,MAAIA,iBAAiBC,SAArB,EAAgC;AAC9B,UAAM,IAAIC,KAAJ,CAAU,yCAAV,CAAN;AACD;AACD,MAAMC,QAAQ,EAAd;AACAA,QAAMC,KAAN,GAAcJ,YAAd;AACAG,QAAME,SAAN,GAAkB,EAAlB;;AAEAF,QAAMG,SAAN,GAAkB,UAACC,QAAD,EAAc;AAC9BJ,UAAME,SAAN,CAAgBG,IAAhB,CAAqBD,QAArB;AACD,GAFD;;AAIAJ,QAAMM,QAAN,GAAiB,UAACC,MAAD,EAAY;AAC3BP,UAAMC,KAAN,GAAcL,QAAQI,MAAMC,KAAd,EAAqBM,MAArB,CAAd;AACAP,UAAME,SAAN,CAAgBM,OAAhB,CAAwB;AAAA,aAAYJ,UAAZ;AAAA,KAAxB;AACD,GAHD;AAIAJ,QAAMS,QAAN,GAAiB;AAAA,WAAMT,MAAMC,KAAZ;AAAA,GAAjB;AACA,SAAOD,KAAP;AACD,CAlBD;;kBAoBeL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QE8GCuB,kBAAAA;;;;AAxIhB;;;;;;;AAOA,SAASC,aAAT,CAAuBC,GAAvB,EAA4BC,KAA5B,EAAgD;AAAA,oCAAVC,QAAU;AAAVA,YAAU;AAAA;;AAC9C,SAAO;AACLF,YADK;AAELC,gBAFK;AAGLC;AAHK,GAAP;AAKD;;AAED,SAASC,QAAT,CAAgBC,KAAhB,EAAuBC,SAAvB,EAAkC;AAChC,SAAOA,UAAUC,WAAV,CAAsBC,QAAQH,KAAR,CAAtB,CAAP;AACD;;AAED,SAASG,OAAT,CAAiBH,KAAjB,EAAwB;AACtBT,UAAQC,GAAR,CAAY,wBAAZ,EAAsCQ,KAAtC;;AAEA,MAAIA,UAAU,IAAV,IAAkBA,UAAU1B,SAAhC,EAA2C;AACzC0B,YAAQ,EAAR;AACD;;AAED,AC1BF,MD0BM,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7BA,YAAQI,OAAOJ,KAAP,CAAR;AACD;;AAED,AC7BF;AD8BE,MAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7B,AC9BJ,WD8BWK,SAASC,cAAT,CAAwBN,KAAxB,CAAP;AACA;AACD;;AAED,MAAI,OAAOA,MAAMJ,GAAb,KAAqB,UAAzB,EAAqC;AACnC,QAAMW,YAAYC,gBAAgBR,MAAMJ,GAAtB,EAA2BI,MAAMH,KAAjC,CAAlB;AACAY,sBAAkBF,SAAlB,EAA6BP,MAAMH,KAAnC;AACA,WAAOU,UAAUG,OAAjB;AACD;;AAED,MAAMC,MAAMN,SAASV,aAAT,CAAuBK,MAAMJ,GAA7B,CAAZ;;AAEA,ACxCF,IAAMpB,EDwCAwB,MAAMH,ACxCE,KDwCZ,EAAiB,mBCxCOX,oBAAZ,EAAqB,CAArB,CAAd;ADyCI0B,WAAOC,IAAP,CAAYb,MAAMH,KAAlB,EAAyBb,OAAzB,CAAiC,eAAO;AACtC,ICxCAwD,MDwCM1B,QAAQd,MAAMH,KAAN,CAAYkB,GAAZ,CAAd;AACAC,mBAAaL,GAAb,EAAkBI,GAAlB,EAAuBD,KAAvB;AACD,KAHD;AAID;;AAED,MAAId,MAAMF,QAAV,EAAoB;AAClBE,UAAMF,QAAN,CAAed,OAAf,CAAuB;AAAA,aAASe,SAAOkB,KAAP,EAAcN,GAAd,CAAT;AAAA,KAAvB;AACD;AACD,SAAOA,GAAP;AACD,6BChDU;AACP,UAAMnC,QAAQ,KAAKiD,KAAL,CAAWjD,KAAzB;ADiDJ,AChDI,SDgDKwC,CChDCyB,MAAMjE,KDgDhB,CAAsBmC,AChDA1B,GDgDtB,EAA2BiC,GChDX,CDgDhB,CChDI,CDgD6BJ,KAAjC,EAAwC;AACtCvB,AChDE,UDgDMC,GAAR,AC/CI,CD+CQ,sCAAZ,EAAoDmB,GAApD,EAAyDO,IAAzD,EAA+DJ,KAA/D;AC/CI;ADiDJ,ACjDI,MDiDAI,ICjDK,KDiDI,MCjDO,KDiDpB,ACjDI,EDiDsBA,OAAO,OAAP;AChDpB;ADkDN,AClDM,MDkDF,QAAQC,IAAR,CAAaD,IAAb,CAAJ,EAAwB;AACtBA,ACnDI,WDmDGA,KAAKE,WAAL,EAAP;AACAT,ACpDI,QDoDAO,IAAJ,IAAYJ,SAAS,EAArB;AAED,ACtDK,GDkDN,MAIO,ACvDH,IDuDOI,SAAS,OAAb,EAAsB;AAC3B,ACtDI,QDsDA,CAACJ,KAAD,IAAU,OAAOA,KAAP,KAAiB,QAA/B,EAAyC;AACvCH,ACvDE,UDuDEU,KAAJ,CAAUC,OAAV,GAAoBR,SAAS,EAA7B;AAED,ACzDG,KDsDJ,MAGO,IAAIA,SAAS,QAAOA,KAAP,yCAAOA,KAAP,OAAiB,QAA9B,EAAwC;AAC7C,AC1DE,WD0DG,IAAII,KAAT,IAAiBJ,KAAjB,EAAwB;AACtBH,AC3DQ8B,YD2DJpB,KAAJ,CAAUH,KAAV,IAAkB,OAAOJ,MAAMI,KAAN,CAAP,KAAuB,QAAvB,GAAkCJ,MAAMI,KAAN,IAAc,IAAhD,GAAuDJ,MAAMI,KAAN,CAAzE;AACD,AC5DC,SAFF;AD+DD,AC5DG;AD8DL,AC9DK,GDoDC,MAUA;AACL,AC/DI,QD+DAA,IC/DQ,ID+DAP,GAAZ,EAAiB,AC/DI;ADgEnBA,AChEmB,UDgEfO,IAAJ,IAAYJ,GChEatC,MDgEJ,AChEUM,EDgE/B,MChEyB,CAAe,EAAEO,MAAM,WAAR,EAAf,CAAN;ADiEpB,ACjEoB,aAAjB;ADkEJ,AClEI,QDkEAyB,KAAJ,EAAW;AACTH,ACnEE,SAHF,CDsEIK,YAAJ,CAAiBE,IAAjB,EAAuBJ,KAAvB;AACD,ACnEG,KDiEJ,MAEO;AACLH,ACpEE,UDoEEY,eAAJ,CAAoBL,IAApB,EAA0BJ,KAA1B;AACD,ACrEG,YAAQ,SAAS;ADsEtB,ACtEsB,qBAAMtC,MAAMM,QAAN,CAAe,EAAEO,MAAM,WAAR,EAAf,CAAN;ADwExB,ACxEwB,aAAjB;AAAA;AAAA,ID0EFmC;AACJ,AC/EI,OADF,gBDgFsB;AAAA,ACxEvB,QDwEWC,KAAY,uEAAJ,EAAI;;AAAA;;AACtB,ECrFca,ODqFT7D,KAAL,GAAa,CCrFO+C,CDqFpB;AACA,SAAKC,KAAL,GAAaA,KAAb;AACD,ACvEH,SAAS1B,MAAT,GAAkB;AAChBuC,kBAAMvC,MAAN,CACE,8BAAC,GAAD,IAAK,OAAOvB,KAAZ,GADF,EAEE6B,SAASqC,cAAT,CAAwB,MAAxB,CAFF;AAID;;AAED3C,6BDkEW2B,aAAa;AACpBnC,cAAQC,GAAR,CAAY,+BAAZ,EAA6CkC,WAA7C;ACjEJlD,MAAMG,SAAN,CAAgBoB,MAAhB;ADmEIa,aAAOe,MAAP,CAAc,KAAKlD,KAAnB,EAA0BiD,WAA1B;AACA;AACAhC,sBAAgB,IAAhB;AACD;;;;;;AAGH;;;AACA,SAASc,eAAT,CAAyBD,SAAzB,EAAoCkB,KAApC,EAA2C;AACzClC,UAAQC,GAAR,CAAY,0CAAZ,EAAwDe,SAAxD,EAAmEkB,KAAnE;;AAEA,MAAIG,aAAJ;AACA;AACA,MAAIrB,UAAUsB,SAAV,IAAuBtB,UAAUsB,SAAV,CAAoB9B,MAA/C,EAAuD;AACrD6B,WAAO,IAAIrB,SAAJ,CAAckB,KAAd,CAAP;AACA;AACD,GAHD,MAGO;AACLG,WAAO,IAAIJ,SAAJ,CAAcC,KAAd,CAAP;AACAG,SAAKE,WAAL,GAAmBvB,SAAnB;AACAqB,SAAK7B,MAAL,GAAc,YAAW;AACvB,aAAO,KAAK+B,WAAL,CAAiBL,KAAjB,CAAP;AACD,KAFD;AAGD;AACD,SAAOG,IAAP;AACD;;AAED,SAASnB,iBAAT,CAA2BF,SAA3B,EAAsCkB,KAAtC,EAA6C;AAC3ClC,UAAQC,GAAR,CAAY,4CAAZ,EAA0De,SAA1D,EAAqEkB,KAArE;AACA,MAAI,CAAClB,UAAUG,OAAf,EAAwB;AACtB,QAAIH,UAAUwB,kBAAd,EAAkC;AAChCxB,gBAAUwB,kBAAV;AACD,KAFD,MAEO,IAAIxB,UAAUyB,yBAAd,EAAyC;AAC9CzB,gBAAUyB,yBAAV,CAAoCP,KAApC;AACD;AACF;AACDlB,YAAUkB,KAAV,GAAkBA,KAAlB;AACA/B,kBAAgBa,SAAhB;AACD;;AAEM,SAASb,eAAT,CAAyBa,SAAzB,EAAoC;AACzChB,UAAQC,GAAR,CAAY,oCAAZ,EAAkDe,SAAlD;;AAEA,MAAIG,gBAAJ;;AAEA,MAAMV,QAAQO,UAAUR,MAAV,EAAd;AACA,MAAIQ,UAAUG,OAAV,IAAqBH,UAAU0B,kBAAnC,EAAuD;AACrD1B,cAAU2B,mBAAV;AACD;AACDxB,YAAUP,QAAQH,KAAR,CAAV;;AAEA,MAAIO,UAAUG,OAAd,EAAuB;AACrB,QAAIH,UAAU4B,iBAAd,EAAiC;AAC/B5B,gBAAU4B,iBAAV;AACD,KAFD,MAEO,IAAI5B,UAAU0B,kBAAd,EAAkC;AACvC1B,gBAAU0B,kBAAV;AACD;AACF;;AAED,MAAI1B,UAAUG,OAAd,EAAuB;AACrBH,cAAUG,OAAV,CAAkB0B,UAAlB,CAA6BC,YAA7B,CAA0C3B,OAA1C,EAAmDH,UAAUG,OAA7D;AACD;;AAEDH,YAAUG,OAAV,GAAoBA,OAApB;AACD;;AAED,IAAM4B,QAAQ;AACZ3C,8BADY;AAEZI,UAAQ,gBAACC,KAAD,EAAQC,SAAR,EAAsB;AAC5BA,cAAUsC,SAAV,GAAsB,EAAtB;AACA,WAAOxC,SAAOC,KAAP,EAAcC,SAAd,CAAP;AACD,GALW;AAMZuB;AANY,CAAd;;kBASec","file":"index-0.aa2681a3.map","sourceRoot":"..","sourcesContent":["/**\n * light-redux.js\n *\n * @author bigggge\n * 2018/3/14.\n */\nconst createStore = (reducer, initialState) => {\n  if (initialState === undefined) {\n    throw new Error('[light-redux] initialState is undefined');\n  }\n  const store = {};\n  store.state = initialState;\n  store.listeners = [];\n\n  store.subscribe = (listener) => {\n    store.listeners.push(listener);\n  };\n\n  store.dispatch = (action) => {\n    store.state = reducer(store.state, action);\n    store.listeners.forEach(listener => listener());\n  };\n  store.getState = () => store.state;\n  return store;\n};\n\nexport default createStore;\n\n","import createStore from './light-redux';\n\nconst INCREMENT = 'INCREMENT';\nconst DECREMENT = 'DECREMENT';\n\nexport function counter(state, action) {\n  switch (action.type) {\n    case INCREMENT:\n      return state + 1;\n    case DECREMENT:\n      return state - 1;\n    default:\n      return 0;\n  }\n}\n\nconst store = createStore(counter, 0);\nconst init = store.getState();\n\nconsole.log(`light-redux init ${init}`);\n\nfunction listener() {\n  const current = store.getState();\n  console.log(`current ${current}`);\n}\n\nstore.subscribe(listener);\nstore.dispatch({ type: 'INCREMENT' });\nstore.dispatch({ type: 'INCREMENT' });\nstore.dispatch({ type: 'DECREMENT' });\nstore.dispatch({ type: 'DECREMENT' });","/**\n * react.js\n *\n * @author bigggge(me@haoduoyu.cc)\n * 2018/9/3.\n */\n\nfunction createElement(tag, attrs, ...children) {\n  return {\n    tag,\n    attrs,\n    children\n  };\n}\n\nfunction render(vnode, container) {\n  return container.appendChild(_render(vnode));\n}\n\nfunction _render(vnode) {\n  console.log(' [React] _render vnode', vnode);\n\n  if (vnode === null || vnode === undefined) {\n    vnode = '';\n  }\n\n  if (typeof vnode === 'number') {\n    vnode = String(vnode);\n  }\n\n  // 渲染字符串\n  if (typeof vnode === 'string') {\n    return document.createTextNode(vnode);\n    // 渲染组件（函数）\n  }\n\n  if (typeof vnode.tag === 'function') {\n    const component = createComponent(vnode.tag, vnode.attrs);\n    setComponentProps(component, vnode.attrs);\n    return component.element;\n  }\n\n  const dom = document.createElement(vnode.tag);\n\n  if (vnode.attrs) {\n    Object.keys(vnode.attrs).forEach(key => {\n      const value = vnode.attrs[key];\n      setAttribute(dom, key, value);\n    });\n  }\n\n  if (vnode.children) {\n    vnode.children.forEach(child => render(child, dom));\n  }\n  return dom;\n}\n\nfunction setAttribute(dom, name, value) {\n  console.log(' [React] setAttribute dom,name,value', dom, name, value);\n\n  if (name === 'className') name = 'class';\n\n  if (/on\\w+/.test(name)) {\n    name = name.toLowerCase();\n    dom[name] = value || '';\n\n  } else if (name === 'style') {\n    if (!value || typeof value === 'string') {\n      dom.style.cssText = value || '';\n\n    } else if (value && typeof value === 'object') {\n      for (let name in value) {\n        dom.style[name] = typeof value[name] === 'number' ? value[name] + 'px' : value[name];\n      }\n    }\n\n  } else {\n    if (name in dom) {\n      dom[name] = value || '';\n    }\n    if (value) {\n      dom.setAttribute(name, value);\n    } else {\n      dom.removeAttribute(name, value);\n    }\n  }\n\n}\n\nclass Component {\n  constructor(props = {}) {\n    this.state = {};\n    this.props = props;\n  }\n\n  setState(stateChange) {\n    console.log(' [React] setState stateChange', stateChange);\n\n    Object.assign(this.state, stateChange);\n    // 渲染组件\n    renderComponent(this);\n  }\n}\n\n// 创建组件\nfunction createComponent(component, props) {\n  console.log(' [React] createComponent component,props', component, props);\n\n  let inst;\n  // 如果是类组件，直接返回实例\n  if (component.prototype && component.prototype.render) {\n    inst = new component(props);\n    // 如果是函数定义组件\n  } else {\n    inst = new Component(props);\n    inst.constructor = component;\n    inst.render = function() {\n      return this.constructor(props);\n    };\n  }\n  return inst;\n}\n\nfunction setComponentProps(component, props) {\n  console.log(' [React] setComponentProps component,props', component, props);\n  if (!component.element) {\n    if (component.componentWillMount) {\n      component.componentWillMount();\n    } else if (component.componentWillReceiveProps) {\n      component.componentWillReceiveProps(props);\n    }\n  }\n  component.props = props;\n  renderComponent(component);\n}\n\nexport function renderComponent(component) {\n  console.log(' [React] renderComponent component', component);\n\n  let element;\n\n  const vnode = component.render();\n  if (component.element && component.componentDidUpdate) {\n    component.componentWillUpdate();\n  }\n  element = _render(vnode);\n\n  if (component.element) {\n    if (component.componentDidMount) {\n      component.componentDidMount();\n    } else if (component.componentDidUpdate) {\n      component.componentDidUpdate();\n    }\n  }\n\n  if (component.element) {\n    component.element.parentNode.replaceChild(element, component.element);\n  }\n\n  component.element = element;\n}\n\nconst React = {\n  createElement,\n  render: (vnode, container) => {\n    container.innerHTML = '';\n    return render(vnode, container);\n  },\n  Component,\n};\n\nexport default React;\n","import createStore from './lib/light-redux';\nimport { counter } from './lib/light-redux.test';\nimport React from '../../light-react/lib/react';\n\nconst store = createStore(counter, 0);\n\nclass App extends React.Component {\n  render() {\n    const store = this.props.store;\n    const num = store.getState();\n    return (\n      <div className={'App'}>\n        <p>light-redux-with-react</p>\n        <p>初始值 {num}</p>\n        <button onClick={() => store.dispatch({ type: 'INCREMENT' })}>increment</button>\n        <button onClick={() => store.dispatch({ type: 'DECREMENT' })}>decrement</button>\n      </div>\n    );\n  }\n\n}\n\nfunction render() {\n  React.render(\n    <App store={store} />,\n    document.getElementById('root')\n  );\n}\n\nrender();\n\nstore.subscribe(render);"]}